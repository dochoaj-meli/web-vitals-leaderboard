import store from"./store.js";import{resultTemplate,skeletonTemplate}from"./templates.js";export default class LeaderboardResults{constructor(){this.t=document.querySelector("table"),this.o=document.querySelector("#content")}s(e){return(t,o)=>null===t.i?1:null===o.i||t.i[e].value<o.i[e].value?-1:t.i[e].value>o.i[e].value?1:0}l(e){e.h?e.h=e.h.map(e=>encodeURIComponent(e)).join(","):e.u&&(e.u=e.u.map(e=>encodeURIComponent(e)).join(","));const t=Object.keys(e).map(t=>t+"="+e[t]).join("&");return fetch("https://crux.pazguille.me/api/web-vitals?"+t).then(e=>e.json()).then(e=>{e.code?store.p({type:"LEADERBOARD_LOADED",error:!0}):store.p({type:"LEADERBOARD_LOADED",m:e})}).catch(()=>{store.p({type:"LEADERBOARD_LOADED",error:!0})})}D(){const{A:e,from:t,h:o,filters:s,L:i,m:r}=store.R();if(e)return this.l({[t]:o,v:s.v,connection:s.connection}),void this.t.setAttribute("hidden","hidden");if(i&&r){const e=r.sort(this.s("LCP")).map((e,t)=>resultTemplate(e,t+=1));return this.t.removeAttribute("hidden"),this.o.innerHTML="",this.o.insertAdjacentHTML("beforeend",e.join("")),void this.t.removeAttribute("hidden")}return!1===i&&o.length>0?(this.t.removeAttribute("hidden"),void this.o.insertAdjacentHTML("beforeend",skeletonTemplate(o[o.length-1]))):!1===i&&0===o.length?(this.o.innerHTML="",this.t.setAttribute("hidden","hidden"),void window.history.replaceState({},"",""+location.pathname)):void 0}init(){store.subscribe(this.D.bind(this))}}